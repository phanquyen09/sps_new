<style type="text/css">
<!--
body {
        font-size:0.8em;
        width:680px;
        margin:1em auto;
        text-align:left;
}
-->
</style>
<!-- StyleSheet & JavaScript(START) -->
<script language="JavaScript">
<!--
function seek(f) {
  checkValueSeek();
  document.IMAGELIST.FILENAME.value = f.FILENAME.value;
  document.IMAGELIST.ALTNAME.value = f.ALTNAME.value;
  document.IMAGELIST.PAGE.value = 1;
  var tmp = f.CATEGORY.options[f.CATEGORY.selectedIndex].value;
  document.IMAGELIST.Category_Id.value = tmp;
  document.IMAGELIST.CMD.value = 'SEEK';
  document.IMAGELIST.submit();

}
urllist = [
  <TMPL_LOOP NAME=URLLIST>[ <TMPL_VAR NAME=URLINFO> ],
  </TMPL_LOOP>
];
altlist = [
  <TMPL_LOOP NAME=ALTLIST>[ <TMPL_VAR NAME=IMAGEALT> ],
  </TMPL_LOOP>
];
function preview(f,n)
{
  var info = urllist[n][f.SIZE.selectedIndex];
  var SPinfo = info.split(",");
  var width  = eval(SPinfo[1]) + 6;
  var height = eval(SPinfo[2]) + 50;

  var w = window.open('', 'popup', 'toolbar=no,location=no,resizable=yes,directories=no,status=no,menubar=no,width=' + width +  ',height=' + height);
  w.document.open();
  w.document.writeln('<html><head>', '<title>画像</title>', '<meta http-equiv="Content-Type" content="text/html; charset=euc-jp">', '</head><body bgcolor="#eeeeee" style="margin: 3px;">', '<div align="center">', '<img name="img" hspace="0" vspace="0" border="0" ', 'src="'+SPinfo[0]+'" width="'+SPinfo[1]+'" height="'+SPinfo[2]+'">', '</div>', '<div align="center" style="margin-top: 10px;">', '<button style="line-height: 1.3em;" onclick="javascript:window.close()">閉じる</button>', '</div></body></html>');
  w.document.close();
  w.window.focus();
}
function instImg(f)
{
  var of = window.opener.document.forms[0];

  var flg = new Boolean(of.dimg);
  if (flg == true) {
    if (of.dimg.value == 1) {
      of.PICSRC_1.src = f.SIZE[f.SIZE.selectedIndex].value;
      of.ImageURL_1.value = f.SIZE[f.SIZE.selectedIndex].value;
      of.ImageID_1.value = f.ID.value;
    } else if (of.dimg.value == 2) {
      of.PICSRC_2.src = f.SIZE[f.SIZE.selectedIndex].value;
      of.ImageURL_2.value = f.SIZE[f.SIZE.selectedIndex].value;
      of.ImageID_2.value = f.ID.value;
    } else if (of.dimg.value == 3) {
      of.PICSRC_3.src = f.SIZE[f.SIZE.selectedIndex].value;
      of.ImageURL_3.value = f.SIZE[f.SIZE.selectedIndex].value;
      of.ImageID_3.value = f.ID.value;
    } else if (of.dimg.value == 4) {
      of.PICSRC_4.src = f.SIZE[f.SIZE.selectedIndex].value;
      of.ImageURL_4.value = f.SIZE[f.SIZE.selectedIndex].value;
      of.ImageID_4.value = f.ID.value;
    } else if (of.dimg.value == 5) {
      of.PICSRC_5.src = f.SIZE[f.SIZE.selectedIndex].value;
      of.ImageURL_5.value = f.SIZE[f.SIZE.selectedIndex].value;
      of.ImageID_5.value = f.ID.value;
    }
    window.self.close();
  }

  of.PICSRC.src = f.SIZE[f.SIZE.selectedIndex].value;
  of.ImageURL.value = f.SIZE[f.SIZE.selectedIndex].value;
  of.ImageID.value = f.ID.value;

  // alert(f.SIZE[f.SIZE.selectedIndex].value);
  window.self.close();
}
<TMPL_IF ADDIMG>
function instAddImg()
{
  var of = window.opener.document.forms[0];

  var flg = new Boolean(of.dimg);
  if (flg == true) {
    if (of.dimg.value == 1) {
      of.PICSRC_1.src = '<TMPL_VAR NAME=ADDPICSRC>';
      of.ImageID_1.value = '<TMPL_VAR NAME=ADDID>';
      window.self.close();
    } else if (of.dimg.value == 2) {
      of.PICSRC_2.src = '<TMPL_VAR NAME=ADDPICSRC>';
      of.ImageID_2.value = '<TMPL_VAR NAME=ADDID>';
      window.self.close();
    } else if (of.dimg.value == 3) {
      of.PICSRC_3.src = '<TMPL_VAR NAME=ADDPICSRC>';
      of.ImageID_3.value = '<TMPL_VAR NAME=ADDID>';
      window.self.close();
    } else if (of.dimg.value == 4) {
      of.PICSRC_4.src = '<TMPL_VAR NAME=ADDPICSRC>';
      of.ImageID_4.value = '<TMPL_VAR NAME=ADDID>';
      window.self.close();
    } else if (of.dimg.value == 5) {
      of.PICSRC_5.src = '<TMPL_VAR NAME=ADDPICSRC>';
      of.ImageID_5.value = '<TMPL_VAR NAME=ADDID>';
      window.self.close();
    }
  }

  of.PICSRC.src = '<TMPL_VAR NAME=ADDPICSRC>';
  of.ImageID.value = '<TMPL_VAR NAME=ADDID>';
  window.self.close();

  // alert('<TMPL_VAR NAME=ADDPICSRC>');
}
</TMPL_IF>
//-->
</script>
<script src="../blog/js/popups/popup.js" type="text/javascript"></script>

<script type="text/javascript">
window.resizeTo(800, 700);
function Init() {
  __dlg_init();
  var param = window.dialogArguments;
  if (param) {
      document.getElementById("f_url").value = param["f_url"];
      document.getElementById("f_alt").value = param["f_alt"];
      document.getElementById("f_border").value = param["f_border"];
      document.getElementById("f_align").value = param["f_align"];
      document.getElementById("f_vert").value = param["f_vert"];
      document.getElementById("f_horiz").value = param["f_horiz"];
      document.getElementById("f_width").value = param["f_width"];
      document.getElementById("f_height").value = param["f_height"];
      window.ipreview.location.replace(param.f_url);
  }
}
function onOK(f, n) {
  var info;
  var SPinfo;
  var rateopt;
  var rateinfo;

  <TMPL_IF NAME=CVT_FLG>
    rateinfo = f.RATE[f.RATE.selectedIndex].value;
    if (rateinfo > 0){
        info = urllist[n][1];
        rateopt  = '?sr.dwp=' + rateinfo;
    }else{
        info = urllist[n][0];
        var uri = window.location.href;
        var str = /smp_shop_top.php/i;
        if(uri.match ( str ))
        {
            rateopt  = '';
        }
        else
        {
            rateopt  = '?sr.nocv=1';
        }
    }
  <TMPL_ELSE>
    info = urllist[n][0];
  </TMPL_IF>

  SPinfo = info.split(",");

  document.form1.f_url.value = f.SIZE.value;
  //document.form1.f_url.value = SPinfo[0];
  document.form1.f_alt.value = altlist[n];
  document.form1.f_align.value = 'baseline';

  var fields = ["f_url", "f_alt", "f_align", "f_border", "f_horiz", "f_vert", "f_width", "f_height"];
  var param = new Object();
  for(var i in fields) {
    var id = fields[i];
    var el = document.getElementById(id);
    if ( id == "f_url" ) {
      <TMPL_IF NAME=CVT_FLG>
        param[id] = el.value + rateopt;
      <TMPL_ELSE>
        param[id] = el.value;
      </TMPL_IF>
    }else{
      param[id] = el.value;
    }
  }

    var tm = window.opener.tinyMCE;
    if (tm.activeEditor == null ) {
    return false;
    }
    var ed    = tm.activeEditor;
    var image = param;
    ed.execCommand('mceInsertContent', false, '<img id="__mce_tmp" />', {skip_undo : 1});
    ed.dom.setAttribs('__mce_tmp', '');
    ed.dom.setAttrib('__mce_tmp', 'src', image.f_url);
    ed.dom.setAttrib('__mce_tmp', 'alt', image.f_alt);
    ed.dom.setAttrib('__mce_tmp', 'height', image.f_height);
    ed.dom.setAttrib('__mce_tmp', 'width', image.f_width);
    ed.dom.setAttrib('__mce_tmp', 'align', image.f_align);
    ed.dom.setAttrib('__mce_tmp', 'border', image.f_border);
    ed.dom.setAttrib('__mce_tmp', 'id', '');
    ed.undoManager.add();

    window.close();

    return false;
};

function onOK2() {

  document.getElementById("f_url").value = '<TMPL_VAR NAME=ADDPICSRC>';
  document.getElementById("f_alt").value = '<TMPL_VAR NAME=ADDPICALT>';
  document.getElementById("f_align").value = 'baseline';


  // __dlg_init();
  window.dialogArguments = opener.Dialog._arguments;
  var param = window.dialogArguments;

  var fields = ["f_url", "f_alt", "f_align", "f_border", "f_horiz", "f_vert", "f_width", "f_height"];
  var param = new Object();
  for(var i in fields) {
    var id = fields[i];
    var el = document.getElementById(id);
    param[id] = el.value;
  }

  var tm = window.opener.tinyMCE;
  if (tm.activeEditor == null ) {
    return false;
  }
  var ed    = tm.activeEditor;
  var image = param;
  ed.execCommand('mceInsertContent', false, '<img id="__mce_tmp" />', {skip_undo : 1});
  ed.dom.setAttribs('__mce_tmp', '');
  ed.dom.setAttrib('__mce_tmp', 'src', image.f_url);
  ed.dom.setAttrib('__mce_tmp', 'alt', image.f_alt);
  ed.dom.setAttrib('__mce_tmp', 'height', image.f_height);
  ed.dom.setAttrib('__mce_tmp', 'width', image.f_width);
  ed.dom.setAttrib('__mce_tmp', 'align', image.f_align);
  ed.dom.setAttrib('__mce_tmp', 'border', image.f_border);
  ed.dom.setAttrib('__mce_tmp', 'id', '');
  ed.undoManager.add();

  window.close();

  return false;
};

function onCancel() {
  __dlg_close(null);
  return false;
};

function imageadd(f) {
  var tmp = f.READY_CATEGORY.options[f.READY_CATEGORY.selectedIndex].value;
  if (tmp != '') f.Category_Id.value = tmp;
  f.submit();
};

// alert( window.opener.editor2._editMode);
function disable_all() {
  document.getElementById("SRCH_BT").disabled = true;
  document.getElementById("UPLOAD_BT").disabled = true;
}
function clearPlaceHolder (e) {
    if ( e.value == 'ファイル名を入力' ) {
        e.value       = "";
        e.style.color = '#000';
    }
}
function setPlaceHolder (e) {
    if ( !e.value ) {
        e.value       = 'ファイル名を入力' ;
        e.style.color = '#999';
    }
}
function clearPlaceHolderAltName (e) {
    if ( e.value == '代替テキストを入力' ) {
        e.value       = "";
        e.style.color = '#000';
    }
}
function setPlaceHolderAltName (e) {
    if ( !e.value ) {
        e.value       = '代替テキストを入力' ;
        e.style.color = '#999';
    }
}
function checkValueSeek(){
  if ( document.SEEK.FILENAME.value == 'ファイル名を入力' ) {
     document.SEEK.FILENAME.value = '';
     document.SEEK.FILENAME.style.color = '#000';
  }
  if ( document.SEEK.ALTNAME.value == '代替テキストを入力' ){
     document.SEEK.ALTNAME.value = '';
     document.SEEK.ALTNAME.style.color = '#000';
  }
}
function checkSeek() {
      if ( document.SEEK.FILENAME.value == '' ) {
          document.SEEK.FILENAME.value = 'ファイル名を入力';
      } else {
          document.SEEK.FILENAME.style.color = '#000';
      }
      if ( document.SEEK.ALTNAME.value == '' ){
          document.SEEK.ALTNAME.value = '代替テキストを入力' ;
      } else {
          document.SEEK.ALTNAME.style.color = '#000';
      }
}
window.onload=checkSeek;
</script>

<link href="../func00/default00.css" rel="stylesheet" type="text/css">
<link href="../css/imagelist.css" rel="stylesheet" type="text/css">

<form name="IMAGELIST" method="POST" action="mbp_selimg.cgi">
<input type="hidden" name="CMD" value="SEEK">
<input type="hidden" name="SELSIZE" value="1">
<input type="hidden" name="PAGE" value="1">
<input type="hidden" name="FILENAME" value="<TMPL_VAR NAME=FILENAME>">
<input type="hidden" name="ALTNAME" value="<TMPL_VAR NAME=ALTNAME>">
<input type="hidden" name="CATEGORY">
<INPUT type="hidden" name="Category_Id" value="<TMPL_VAR NAME=CATEGORY_ID>">
<input type="hidden" name="is_smp" value="<TMPL_VAR NAME=is_smp>">
</form>
<div id="imgList">
  <div class="title">|| 画像挿入</div>
  <div class="infoArea lBlue" style="margin:0 0 1.5em">
    ファイル名や代替テキストの入力方法、エラー対策など、画像の追加方法につきましては「画像挿入について」をご覧ください。
    <a href="https://help.shopserve.jp/manual/058/" target="_blank">⇒ 画像挿入について</a>
  </div>
  <TMPL_LOOP NAME=ERR_MSG>
  <font color="red">&nbsp;・<TMPL_VAR NAME=MSG></font><br>
  </TMPL_LOOP>
  <table class="imgBox" style="margin:0 0 2em">
  <form name="IMAGEADD" method="POST" action="mbp_selimg.cgi" enctype="multipart/form-data">
  <INPUT type="hidden" name="Category_Id">
  <input type="hidden" name="CMD" value="ADD">
  <input type="hidden" name="SELSIZE" value="1">
  <input type="hidden" name="refurl" value="<TMPL_VAR NAME=refurl>">
  <input type="hidden" name="is_smp" value="<TMPL_VAR NAME=is_smp>">
  <tr>
    <th colspan="2" class="dBlue">新規画像を挿入</th>
  </tr>
  <tr>
    <td width="20%" class="mBlue">画像ファイル</td>
    <td width="80%">
      <input name="UPFILE" type="file" size="90" class="file"><br>
      登録可能なファイル（<span class="fRed">2MB以内</span>） ： jpeg / jpg / gif / png
    </td>
  </tr>
  <tr>
    <td class="mBlue">ファイル名</td>
    <td>
      <input name="ImageName" type="text" value="<TMPL_VAR NAME=IMAGENAME>" style="ime-mode:disabled"><br>
      ※画像ファイル名が日本語の場合は、拡張子も含め<span class="fRed">半角英数</span>で入力してください。<br>
      例）ショップタイトル.gif ⇒ <span class="fRed">shop_title.gif</span>
    </td>
  </tr>
  <tr>
    <td class="mBlue">代替テキスト</td>
    <td><input name="ImageAlt" type="text" class="alt" value="<TMPL_VAR NAME=IMAGEALT>"></td>
  </tr>
  <tr>
    <td class="mBlue">縮小率指定</td>
    <td>
  <TMPL_IF NAME=CVT_FLG>
      <input type="radio" name="Rate" value="100" <TMPL_IF RATE_100>checked</TMPL_IF>>100%
      <input type="radio" name="Rate" value="75" <TMPL_IF RATE_75>checked</TMPL_IF>>75%
      <input type="radio" name="Rate" value="50" <TMPL_IF RATE_50>checked</TMPL_IF>>50%
      <input type="radio" name="Rate" value="25" <TMPL_IF RATE_25>checked</TMPL_IF>>25%
      <input type="radio" name="Rate" value="0" <TMPL_IF RATE_0>checked</TMPL_IF>>オリジナル
  <TMPL_ELSE>
      <input type="radio" name="Rate" value="0" checked>オリジナル
  </TMPL_IF>
    </td>
  </tr>
  <tr>
    <td class="mBlue">画像カテゴリ</td>
    <td>
      <select name="READY_CATEGORY">
        <option value="">既存カテゴリから選択</option>
        <TMPL_LOOP NAME=CateList>
        <option value="<TMPL_VAR NAME=ID>" <TMPL_IF NAME=ADD_SELECT>selected</TMPL_IF>><TMPL_VAR NAME=CATEGORY></option>
        </TMPL_LOOP>
      </select>
      <br>
      新規作成
      <input name="Category" type="text" value="<TMPL_VAR NAME=CATEGORY>" <TMPL_IF NAME=CATMAX>disabled</TMPL_IF>>
      <TMPL_IF NAME=CATMAX>
      <br><font color="#FF0000">※画像カテゴリが最大数（<TMPL_VAR NAME=MAXCATEGORY>個）まで登録されています。</font>
      </TMPL_IF>
    </td>
  </tr>
  <tr>
    <td colspan="2" class="center">
      <input type="button" id="UPLOAD_BT" name="ADD" value="挿入する" onClick='imageadd(document.IMAGEADD);'>
    </td>
  </tr>
  </form>
  </table>

  <div class="infoArea lBlue" style="margin:0 0 1em">
    以下の画像台帳から挿入する場合は、画面に対しての縮小率を選択して［挿入する］ボタンをクリックしてください。
  </div>
    <style type="text/css">
    <!--
    /********** 以下を default01.css の「共通」の上に追加 **********/
    /************************************************/
    /*画像台帳*/
    /************************************************/
    /* 画像検索用 */
    #imgSearchBox {margin:2em 0 1em;padding:5px;border:1px solid #999;background:#eee;}
    #imgSearchBox span {padding:0 5px;}
    #imgSearchBox input[type=text] {color:#999;width:10em;}
    //-->
    </style>
    <form name="SEEK" method="POST" action="mbp_selimg.cgi" >
    <div id="imgSearchBox">
        <span>画像検索</span>
        <input name="FILENAME" id="FILENAME" style="width:160px;" type="text"  value="<TMPL_VAR NAME=FILENAME>" style="ime-mode:disabled" onfocus="clearPlaceHolder(this);" onblur="setPlaceHolder(this);">
        <input name="ALTNAME"  id="ALTNAME" style="width:160px;" type="text"  value="<TMPL_VAR NAME=ALTNAME>" onfocus="clearPlaceHolderAltName(this);" onblur="setPlaceHolderAltName(this);">
          <select name="CATEGORY">
          <option value="">既存カテゴリから選択</option>
          <TMPL_LOOP NAME=CateList>
          <option value="<TMPL_VAR NAME=ID>" <TMPL_IF NAME=SRCH_SELECT>selected</TMPL_IF>><TMPL_VAR NAME=CATEGORY></option>
          </TMPL_LOOP>
          </select>
          <input type="button" id="SRCH_BT" name="Submit" value="検索する" onClick="document.IMAGELIST.CMD.value='SEEK';document.IMAGELIST.action='mbp_selimg.cgi';disable_all();seek(document.SEEK)">
        
    </div>
    <input type="hidden" name="CMD" value="SEEK">
    <input type="hidden" name="PAGE" value="<TMPL_VAR NAME=PAGE>">
    <input type="hidden" name="is_smp" value="<TMPL_VAR NAME=is_smp>">
    <br/>
  <div class="page">
    <TMPL_IF TOTAL>
    <TMPL_VAR NAME=LISTSTART> - <TMPL_VAR NAME=LISTEND>&nbsp; （ 全 <TMPL_VAR NAME=TOTAL>件 ）&nbsp;<TMPL_LOOP NAME=PAGE_LIST><TMPL_VAR NAME=LINK></TMPL_LOOP>
    </TMPL_IF>
  </div>
  </form>
  <table class="imgBox">
  <tr>
    <th colspan="3" class="dBlue">画像台帳から挿入</th>
  </tr>
  <tr>
    <td class="center mBlue" style="width:15%">画像</td>
    <td class="center mBlue" style="width:45%">ファイル名 [登録日]/挿入する</td>
    <td class="center mBlue" style="width:40%">代替テキスト/画像カテゴリ</td>
  </tr>
  <TMPL_LOOP NAME=ORIGINALS>
  <form name="IMG<TMPL_VAR NAME=ID>">
  <tr>
    <td class="center">
      <input type="hidden" name="ID" value="<TMPL_VAR NAME=ID>">
      <image id="PICSRC" src="<TMPL_VAR NAME=IMGURL>/docs/pic-labo/timg/<TMPL_VAR NAME=FILENAME>" alt="<TMPL_VAR NAME=ALT>" width="<TMPL_VAR NAME=TWIDTH>" height="<TMPL_VAR NAME=THEIGHT>" border="0">
    </td>
    <td>
      <TMPL_VAR NAME=FILENAME><span class="date">[<TMPL_VAR NAME=SETDATE>]</span><br>
      <TMPL_LOOP SZLIST>
      <input type="hidden" name="SIZE" value="<TMPL_VAR NAME=URL>">
      </TMPL_LOOP>
      <TMPL_IF NAME=CVT_FLG>
      <select name="RATE">
      <option value="100">100%</option>
      <option value="75">75%</option>
      <option value="50">50%</option>
      <option value="25">25%</option>
      <option value="0">オリジナル</option>
      </select>
      <TMPL_ELSE>
        <select name="RATE">
          <option value="0">オリジナル</option>
        </select>
      </TMPL_IF>
      <input type="button" name="INST" value="挿入" onClick='onOK(document.IMG<TMPL_VAR NAME=ID>, <TMPL_VAR NAME=NO>);'>
    </td>
    <td>
      <div class="txtCat" style="margin-bottom:0.2em"><TMPL_VAR NAME=ALT>&nbsp;</div>
      <div class="txtCat"><TMPL_VAR NAME=CATEGORY>&nbsp;</div>
    </td>
  </tr>
  </form>
  </TMPL_LOOP>
  </table>
  <div class="page" style="margin:0 0 2em">
    <TMPL_IF TOTAL>
    <TMPL_VAR NAME=LISTSTART> - <TMPL_VAR NAME=LISTEND>&nbsp; （ 全 <TMPL_VAR NAME=TOTAL>件 ）
    &nbsp;<TMPL_LOOP NAME=PAGE_LIST><TMPL_VAR NAME=LINK></TMPL_LOOP>
    </TMPL_IF>
    </div>
  <div class="center" style="border-top:1px solid #999;margin:3em 0 0;padding:2em 0 2em">
    <input type="button" name="Submit" value="閉じる" onClick="window.close()">
  </div>
<form name="form1" method="post">
<input type="hidden" name="f_url" id="f_url" value="">
<input type="hidden" name="f_width" id="f_width" value="">
<input type="hidden" name="f_height" id="f_height" value="">
<input type="hidden" name="f_alt" id="f_alt" value="">
<input type="hidden" name="f_border" id="f_border" value="">
<input type="hidden" name="f_horiz" id="f_horiz" value="">
<input type="hidden" name="f_vert" id="f_vert" value="">
<input type="hidden" name="f_align" id="f_align" value="">
</form>

<TMPL_IF ADDIMG>
<img src="../imgs/spc.gif" onLoad="onOK2();">
</TMPL_IF>
</div>
